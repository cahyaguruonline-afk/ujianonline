///////////////Rubah Script di Bawah///////////////////////
<div class="table-header">
              <h3 class="table-title">Rekap Hasil Ujian</h3>
              <div style="display: flex;
align-items: center; gap: 1rem;">
                <button class="btn btn-success" onclick="loadHasil()">
                  <i class="fas fa-sync"></i>
                  Refresh
                </button>
                <button id="btnSimpanEsai" class="btn btn-primary" onclick="simpanNilaiEsai()">
   <i class="fas fa-save"></i>
                  Simpan Nilai Esai
                </button>
              </div>
            </div>

// Menjadi
<div class="table-header">
              <h3 class="table-title">Rekap Hasil Ujian</h3>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <button class="btn btn-success" onclick="loadHasil()">
                  <i class="fas fa-sync"></i>
                  Refresh
                </button>
                
                <button class="btn" onclick="downloadHasilXLS()" style="background: linear-gradient(135deg, #10b981, #059669); color: white;">
                  <i class="fas fa-file-excel"></i>
                  Download XLS
                </button>
                <button id="btnSimpanEsai" class="btn btn-primary" onclick="simpanNilaiEsai()">
                   <i class="fas fa-save"></i>
                  Simpan Nilai Esai
                </button>
              </div>
            </div>
///////////////SELESAI///////////////////////


// [TAMBAHKAN FUNGSI INI KE <script> di Admin.html.txt]

// [GANTI SELURUH FUNGSI downloadHasilXLS() DI Admin.html.txt]

function downloadHasilXLS() {
  // Tampilkan loading
  showLoading('Mempersiapkan link download...');
  const sessionId = sessionStorage.getItem('sessionId');

  // Panggil fungsi backend baru
  google.script.run
    .withSuccessHandler(response => {
      hideLoading();
      if (response.success && response.url) {
        showToast('Link download berhasil dibuat. Download akan dimulai.', 'success');
        
        // --- PERBAIKAN: Menggunakan elemen <a> temporer ---
        const downloadLink = document.createElement('a');
        downloadLink.href = response.url;
        downloadLink.target = '_blank'; // Buka di tab baru
        downloadLink.style.display = 'none';
        
        // Tambahkan link ke DOM, klik, lalu hapus
        document.body.appendChild(downloadLink);
        downloadLink.click();
        document.body.removeChild(downloadLink);
        // --------------------------------------------------
        
      } else {
        // Tampilkan error jika gagal
        showToast(response.message || 'Gagal membuat link download.', 'error');
      }
    })
    .withFailureHandler(err => {
      hideLoading();
      // Ini akan menangkap error dari Apps Script (Backend)
      showToast('Error Server (Backend): ' + err.message, 'error');
    })
    .getDownloadLinkXLS(sessionId);
}
